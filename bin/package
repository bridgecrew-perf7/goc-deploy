#!/bin/bash

read -p %1
TODAY=`date +"%Y-%m-%d"`

cd ../../src

php artisan view:clear &&
php artisan route:clear &&
php artisan event:clear &&
#php artisan debugbar:clear &&
php artisan config:clear &&
php artisan cache:clear &&
php artisan clear-compiled &&
php artisan passport:purge

msgfmt ./resources/i18n/en_CA/LC_MESSAGES/messages.po -o ./resources/i18n/en_CA/LC_MESSAGES/messages.mo
msgfmt ./resources/i18n/fr_CA/LC_MESSAGES/messages.po -o ./resources/i18n/fr_CA/LC_MESSAGES/messages.mo

composer install --optimize-autoloader --no-dev
bower install
npm install
npm run production

read -p "Build Completed, Press any key to continue..."

cd ..

tar --exclude-vcs \
    --exclude="./src/bower_components" \
    --exclude="./src/node_modules" \
    --exclude="./src/storage" \
    --exclude='.idea' \
    -zvcf \
    "passport-src_${TODAY}.tar.gz" \
    ./src


//tar --exclude-vcs --exclude='.idea' --exclude='.git' --exclude='.gitlab' --exclude='storage' --exclude='tests' --exclude='.env' --exclude='.gitignore' --exclude='.editorconfig' --exclude='scripts' --exclude='bootstrap/cache/*' -zvcf "gcsx-src_${TODAY}.tar.gz" ./gcsx

mv "passport-src_${TODAY}.tar.gz" ../

cd src
composer install
npm run dev
cd ../scripts/deploy

